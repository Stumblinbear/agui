<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Keyed Widgets</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../getting_started.html">Getting Started</a></li><li class="chapter-item expanded affix "><li class="part-title">Usage</li><li class="chapter-item expanded "><a href="../usage/macros.html"><strong aria-hidden="true">1.</strong> Macros</a></li><li class="chapter-item expanded "><a href="../usage/widgets.html"><strong aria-hidden="true">2.</strong> Widgets</a></li><li class="chapter-item expanded "><a href="../usage/layout.html"><strong aria-hidden="true">3.</strong> Layout</a></li><li class="chapter-item expanded "><a href="../usage/state.html"><strong aria-hidden="true">4.</strong> State</a></li><li class="chapter-item expanded "><a href="../usage/fonts.html"><strong aria-hidden="true">5.</strong> Fonts</a></li><li class="chapter-item expanded "><a href="../usage/clipping.html"><strong aria-hidden="true">6.</strong> Clipping</a></li><li class="chapter-item expanded "><a href="../usage/keyed-widgets.html" class="active"><strong aria-hidden="true">7.</strong> Keyed Widgets</a></li><li class="chapter-item expanded "><a href="../usage/computed.html"><strong aria-hidden="true">8.</strong> Computed Values</a></li><li class="chapter-item expanded "><a href="../usage/limiting-rebuilds.html"><strong aria-hidden="true">9.</strong> Limiting Rebuilds</a></li><li class="chapter-item expanded affix "><li class="part-title">Plugins</li><li class="chapter-item expanded "><a href="../plugins/providers_and_consumers.html"><strong aria-hidden="true">10.</strong> Providers &amp; Consumers</a></li><li class="chapter-item expanded "><a href="../plugins/hovering.html"><strong aria-hidden="true">11.</strong> Hovering</a></li><li class="chapter-item expanded "><a href="../plugins/themes.html"><strong aria-hidden="true">12.</strong> Themes</a></li><li class="chapter-item expanded "><a href="../plugins/animations.html"><strong aria-hidden="true">13.</strong> Animations</a></li><li class="chapter-item expanded "><a href="../plugins/writing_a_plugin.html"><strong aria-hidden="true">14.</strong> Writing your Own</a></li><li class="chapter-item expanded affix "><li class="part-title">Widget Reference</li><li class="chapter-item expanded "><a href="../widgets/primitives.html"><strong aria-hidden="true">15.</strong> Primitives</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../widgets/primitives/layout.html"><strong aria-hidden="true">15.1.</strong> Layout</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../widgets/primitives/row.html"><strong aria-hidden="true">15.1.1.</strong> Row</a></li><li class="chapter-item expanded "><a href="../widgets/primitives/column.html"><strong aria-hidden="true">15.1.2.</strong> Column</a></li><li class="chapter-item expanded "><a href="../widgets/primitives/spadding.html"><strong aria-hidden="true">15.1.3.</strong> Padding</a></li><li class="chapter-item expanded "><a href="../widgets/primitives/sspacing.html"><strong aria-hidden="true">15.1.4.</strong> Spacing</a></li></ol></li><li class="chapter-item expanded "><a href="../widgets/primitives/drawable.html"><strong aria-hidden="true">15.2.</strong> Drawable</a></li><li class="chapter-item expanded "><a href="../widgets/primitives/text.html"><strong aria-hidden="true">15.3.</strong> Text</a></li></ol></li><li class="chapter-item expanded "><a href="../widgets/widgets.html"><strong aria-hidden="true">16.</strong> Widgets</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../widgets/widgets/app.html"><strong aria-hidden="true">16.1.</strong> App</a></li><li class="chapter-item expanded "><a href="../widgets/widgets/button.html"><strong aria-hidden="true">16.2.</strong> Button</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Integrations</li><li class="chapter-item expanded "><a href="../integrations/how_they_work.html"><strong aria-hidden="true">17.</strong> How they work</a></li><li class="chapter-item expanded "><a href="../integrations/writing_your_own.html"><strong aria-hidden="true">18.</strong> Writing your own</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../integrations/writing_your_own/guarantees.html"><strong aria-hidden="true">18.1.</strong> Guarantees</a></li><li class="chapter-item expanded "><a href="../integrations/writing_your_own/layers.html"><strong aria-hidden="true">18.2.</strong> Layers</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Cookbook</li><li class="chapter-item expanded "><a href="../cookbook/title_screen.html"><strong aria-hidden="true">19.</strong> Title Screen</a></li><li class="chapter-item expanded "><a href="../cookbook/settings.html"><strong aria-hidden="true">20.</strong> Settings</a></li><li class="chapter-item expanded "><a href="../cookbook/scroll_view.html"><strong aria-hidden="true">21.</strong> Scroll View</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="keyed-widgets"><a class="header" href="#keyed-widgets">Keyed Widgets</a></h1>
<p>Occasionally you'll run into a situation where you are <em>absolutely positive</em> that child widgets will not react to a parent rebuilding. In these cases, keyed widgets come to the rescue. However, they must be used carefully as they may cause logical inconsistencies or non-deterministic behavior if used incorrectly. Another way to think of them are as &quot;cache keys&quot; instead of just keys.</p>
<p>There are two <em>types</em> of keys, at the time of writing:</p>
<ul>
<li><strong>Local</strong>: These are scoped to the widget creating the key, and don't propagate down to children.</li>
<li><strong>Global</strong>: These are scoped to the entire application, meaning widgets can move around the tree in certain situations.</li>
</ul>
<p>There's also a third &quot;type&quot;, and that's unique keys (which are really just Global keys). These are explained in a bit more detail below.</p>
<h1 id="motivation-and-usage"><a class="header" href="#motivation-and-usage">Motivation and Usage</a></h1>
<p>Imagine a situation where you have a widget which only provides layout sizing to its children, and reacts to some global state to set that size. This is the exact situation for the <code>App</code> widget:</p>
<pre><code class="language-rust noplaypen">#[functional_widget]
fn app(ctx: &amp;WidgetContext, child: WidgetRef) -&gt; BuildResult {
    // Fetch the `AppSettings` global, which contains app sizing information
    let settings = ctx.use_global::&lt;AppSettings, _&gt;(AppSettings::default);

    let settings = settings.read();

    // Set the sizing of this widget, so children may take up the entirety of the app size
    ctx.set_layout(build! {
        Layout {
            sizing: Sizing::Axis {
                width: Units::Pixels(settings.width),
                height: Units::Pixels(settings.height),
            }
        }
    });

    // Return the child
    child.into()
}
</code></pre>
<p>In this case, this would cause child widgets to be rebuilt whenever the app size changes (think window resizing), incurring potentially expensive tree operations and absolute state loss of all children. In this case, we can guarantee that the widget rebuilding won't change the children in any way. <em>Given these guarantees</em>, we can use a Key. Simply change the last line to this:</p>
<pre><code class="language-rust noplaypen">// `Key::single()` is a helper alias of `Key::Local(0)`
ctx.key(Key::single(), child).into()
</code></pre>
<p>This will cause the child widget to be cached and reused when the parent <code>App</code> widget is rebuilt, instead of recreating it from scratch. The exact meaning of this line will be elaborated on in a moment.</p>
<h2 id="limitations"><a class="header" href="#limitations">Limitations</a></h2>
<p>Keys are limited in how they function, and it's important to understand these limitations to use them effectively.</p>
<p>Most notably, only one key with the same value may exist in any given scope. Two local keys with the same value may not exist in a single widget, but two separate widgets (even if one is a child of the other) may share exact values without issue. The same cannot be said for global keys, which must exist once in the entirety of your application. If you break this convention, your application <em>will</em> <code>panic!</code> if two keys clash during a rebuild.</p>
<p>Additionally, keys only function if the widget is removed and re-added to the tree within a single update. If you have a keyed widget that gets removed from the tree, but then gets added back into the tree in a subsequent <code>update()</code>, then it will be regenerated anew.</p>
<h2 id="local-keys"><a class="header" href="#local-keys">Local Keys</a></h2>
<p>Local keys are just as the name implies: they're local to the widget that defined them. If your widget can function using local keys, it's highly recommended to use them over any other since they come with the fewest strings attached.</p>
<pre><code class="language-rust noplaypen">Key::single() // If the widget only contains one keyed widget

// Otherwise, we use

Key::local(hashable_value)

// or

Key::Local(u64)
</code></pre>
<h2 id="global-keys"><a class="header" href="#global-keys">Global Keys</a></h2>
<p>Global keys, just like globals, can be used throughout the entirety of your application. They <strong>must</strong> follow the convention of each key being entirely unique to your application, and should not be used by third party widget crates. Third parties should use unique keys, or accept a key as a parameter.</p>
<pre><code class="language-rust noplaypen">Key::global(hashable_value)

// or

Key::Global(u64)
</code></pre>
<h3 id="unique-keys"><a class="header" href="#unique-keys">Unique Keys</a></h3>
<p>Unique keys are global keys, but they're designed to be passed as an argument to child widgets. These are non-deterministic, and a new one should be generated each time one is created, using <code>Key::unique()</code>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../usage/clipping.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../usage/computed.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../usage/clipping.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../usage/computed.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
